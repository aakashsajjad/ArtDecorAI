-- This file was generated by the Supabase CLI.
-- Seed data for the ArtDecorAI project

-- Enable necessary extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "vector";

-- Create artwork table
CREATE TABLE IF NOT EXISTS public.artwork (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    title TEXT NOT NULL,
    brand TEXT,
    price DECIMAL(10,2),
    style_tags TEXT[],
    dominant_palette JSONB,
    image_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create artwork_embedding table for vector storage
CREATE TABLE IF NOT EXISTS public.artwork_embedding (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    vector VECTOR(384), -- Adjust dimension based on your embedding model
    artwork_id UUID REFERENCES public.artwork(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create room_upload table
CREATE TABLE IF NOT EXISTS public.room_upload (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    user_id UUID,
    room_type TEXT,
    s3_url TEXT,
    palette_json JSONB,
    lighting_json JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create session table
CREATE TABLE IF NOT EXISTS public.session (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    user_id UUID,
    query_text TEXT,
    topk_ids UUID[],
    chosen_id UUID,
    rationale TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create user_profile table
CREATE TABLE IF NOT EXISTS public.user_profile (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    user_id UUID UNIQUE,
    preferred_styles TEXT[],
    color_profile_json JSONB,
    budget_range JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create indexes for better performance
CREATE INDEX IF NOT EXISTS idx_artwork_style_tags ON public.artwork USING GIN(style_tags);
CREATE INDEX IF NOT EXISTS idx_artwork_embedding_vector ON public.artwork_embedding USING ivfflat (vector vector_cosine_ops);
CREATE INDEX IF NOT EXISTS idx_room_upload_user_id ON public.room_upload(user_id);
CREATE INDEX IF NOT EXISTS idx_session_user_id ON public.session(user_id);

-- Insert sample artwork data
INSERT INTO public.artwork (title, brand, price, style_tags, dominant_palette, image_url) VALUES
('Abstract Blue Waves', 'ModernArt Co.', 299.99, ARRAY['abstract', 'modern', 'blue'], '{"primary": "#1e3a8a", "secondary": "#3b82f6", "accent": "#93c5fd"}', 'https://example.com/artwork1.jpg'),
('Minimalist Black Lines', 'Minimal Designs', 199.99, ARRAY['minimalist', 'black', 'geometric'], '{"primary": "#000000", "secondary": "#404040", "accent": "#808080"}', 'https://example.com/artwork2.jpg'),
('Vintage Botanical Print', 'Botanical Arts', 149.99, ARRAY['vintage', 'botanical', 'green'], '{"primary": "#166534", "secondary": "#22c55e", "accent": "#84cc16"}', 'https://example.com/artwork3.jpg'),
('Contemporary Abstract', 'Urban Gallery', 399.99, ARRAY['contemporary', 'abstract', 'colorful'], '{"primary": "#dc2626", "secondary": "#f59e0b", "accent": "#eab308"}', 'https://example.com/artwork4.jpg'),
('Scandinavian Geometric', 'Nordic Design', 249.99, ARRAY['scandinavian', 'geometric', 'neutral'], '{"primary": "#f3f4f6", "secondary": "#9ca3af", "accent": "#374151"}', 'https://example.com/artwork5.jpg');

-- Insert sample embedding data (placeholder vectors - replace with actual embeddings)
INSERT INTO public.artwork_embedding (artwork_id, vector) 
SELECT 
    a.id,
    ARRAY[0.1, 0.2, 0.3, 0.4, 0.5]::vector(384) -- Placeholder vector, replace with actual embeddings
FROM public.artwork a
WHERE a.title = 'Abstract Blue Waves';

INSERT INTO public.artwork_embedding (artwork_id, vector) 
SELECT 
    a.id,
    ARRAY[0.2, 0.3, 0.4, 0.5, 0.6]::vector(384) -- Placeholder vector, replace with actual embeddings
FROM public.artwork a
WHERE a.title = 'Minimalist Black Lines';

INSERT INTO public.artwork_embedding (artwork_id, vector) 
SELECT 
    a.id,
    ARRAY[0.3, 0.4, 0.5, 0.6, 0.7]::vector(384) -- Placeholder vector, replace with actual embeddings
FROM public.artwork a
WHERE a.title = 'Vintage Botanical Print';

INSERT INTO public.artwork_embedding (artwork_id, vector) 
SELECT 
    a.id,
    ARRAY[0.4, 0.5, 0.6, 0.7, 0.8]::vector(384) -- Placeholder vector, replace with actual embeddings
FROM public.artwork a
WHERE a.title = 'Contemporary Abstract';

INSERT INTO public.artwork_embedding (artwork_id, vector) 
SELECT 
    a.id,
    ARRAY[0.5, 0.6, 0.7, 0.8, 0.9]::vector(384) -- Placeholder vector, replace with actual embeddings
FROM public.artwork a
WHERE a.title = 'Scandinavian Geometric';

-- Insert sample room upload data
INSERT INTO public.room_upload (user_id, room_type, s3_url, palette_json, lighting_json) VALUES
('550e8400-e29b-41d4-a716-446655440000', 'living_room', 'https://s3.example.com/rooms/living_room_1.jpg', 
 '{"primary": "#f3f4f6", "secondary": "#9ca3af", "accent": "#374151", "neutral": "#ffffff"}',
 '{"brightness": 0.8, "temperature": "warm", "natural_light": true}'),
('550e8400-e29b-41d4-a716-446655440001', 'bedroom', 'https://s3.example.com/rooms/bedroom_1.jpg',
 '{"primary": "#1e3a8a", "secondary": "#3b82f6", "accent": "#93c5fd", "neutral": "#f8fafc"}',
 '{"brightness": 0.6, "temperature": "cool", "natural_light": false}'),
('550e8400-e29b-41d4-a716-446655440002', 'kitchen', 'https://s3.example.com/rooms/kitchen_1.jpg',
 '{"primary": "#166534", "secondary": "#22c55e", "accent": "#84cc16", "neutral": "#ffffff"}',
 '{"brightness": 0.9, "temperature": "neutral", "natural_light": true}'),
('550e8400-e29b-41d4-a716-446655440003', 'office', 'https://s3.example.com/rooms/office_1.jpg',
 '{"primary": "#000000", "secondary": "#404040", "accent": "#808080", "neutral": "#f3f4f6"}',
 '{"brightness": 0.7, "temperature": "cool", "natural_light": true}'),
('550e8400-e29b-41d4-a716-446655440004', 'dining_room', 'https://s3.example.com/rooms/dining_room_1.jpg',
 '{"primary": "#dc2626", "secondary": "#f59e0b", "accent": "#eab308", "neutral": "#fef2f2"}',
 '{"brightness": 0.8, "temperature": "warm", "natural_light": true}');

-- Insert sample session data
INSERT INTO public.session (user_id, query_text, topk_ids, chosen_id, rationale) VALUES
('550e8400-e29b-41d4-a716-446655440000', 'Show me modern abstract art for my living room', 
 ARRAY['550e8400-e29b-41d4-a716-446655440010', '550e8400-e29b-41d4-a716-446655440011', '550e8400-e29b-41d4-a716-446655440012'],
 '550e8400-e29b-41d4-a716-446655440010',
 'This abstract blue waves piece complements your neutral living room palette and adds visual interest without overwhelming the space. The blue tones create a calming atmosphere perfect for relaxation.'),
('550e8400-e29b-41d4-a716-446655440001', 'I need minimalist art for my bedroom', 
 ARRAY['550e8400-e29b-41d4-a716-446655440013', '550e8400-e29b-41d4-a716-446655440014'],
 '550e8400-e29b-41d4-a716-446655440013',
 'The minimalist black lines artwork provides a clean, sophisticated look that matches your bedroom''s serene aesthetic. Its geometric simplicity promotes restful sleep.'),
('550e8400-e29b-41d4-a716-446655440002', 'Find botanical prints for my kitchen', 
 ARRAY['550e8400-e29b-41d4-a716-446655440015', '550e8400-e29b-41d4-a716-446655440016', '550e8400-e29b-41d4-a716-446655440017'],
 '550e8400-e29b-41d4-a716-446655440015',
 'This vintage botanical print brings natural elements into your kitchen, creating a fresh, organic feel. The green tones complement your kitchen''s color scheme and add life to the space.'),
('550e8400-e29b-41d4-a716-446655440003', 'Contemporary art for my office space', 
 ARRAY['550e8400-e29b-41d4-a716-446655440018', '550e8400-e29b-41d4-a716-446655440019'],
 '550e8400-e29b-41d4-a716-446655440018',
 'The contemporary abstract piece provides visual stimulation for your office while maintaining professionalism. Its vibrant colors can boost creativity and energy during work hours.'),
('550e8400-e29b-41d4-a716-446655440004', 'Scandinavian style art for dining room', 
 ARRAY['550e8400-e29b-41d4-a716-446655440020', '550e8400-e29b-41d4-a716-446655440021'],
 '550e8400-e29b-41d4-a716-446655440020',
 'This Scandinavian geometric artwork embodies the clean, functional aesthetic of Nordic design. Its neutral tones and geometric patterns create a sophisticated dining atmosphere.');

-- Insert sample user profile data
INSERT INTO public.user_profile (user_id, preferred_styles, color_profile_json, budget_range) VALUES
('550e8400-e29b-41d4-a716-446655440000', ARRAY['modern', 'abstract', 'contemporary'], 
 '{"favorite_colors": ["#1e3a8a", "#3b82f6", "#93c5fd"], "avoid_colors": ["#dc2626", "#f59e0b"], "preferred_temperature": "cool", "brightness_preference": "medium"}',
 '{"min": 100, "max": 500, "currency": "USD"}'),
('550e8400-e29b-41d4-a716-446655440001', ARRAY['minimalist', 'scandinavian', 'geometric'], 
 '{"favorite_colors": ["#000000", "#404040", "#808080"], "avoid_colors": ["#dc2626", "#f59e0b"], "preferred_temperature": "neutral", "brightness_preference": "low"}',
 '{"min": 50, "max": 300, "currency": "USD"}'),
('550e8400-e29b-41d4-a716-446655440002', ARRAY['vintage', 'botanical', 'natural'], 
 '{"favorite_colors": ["#166534", "#22c55e", "#84cc16"], "avoid_colors": ["#000000", "#404040"], "preferred_temperature": "warm", "brightness_preference": "high"}',
 '{"min": 75, "max": 400, "currency": "USD"}'),
('550e8400-e29b-41d4-a716-446655440003', ARRAY['contemporary', 'abstract', 'colorful'], 
 '{"favorite_colors": ["#dc2626", "#f59e0b", "#eab308"], "avoid_colors": ["#000000", "#404040"], "preferred_temperature": "warm", "brightness_preference": "high"}',
 '{"min": 200, "max": 800, "currency": "USD"}'),
('550e8400-e29b-41d4-a716-446655440004', ARRAY['scandinavian', 'geometric', 'neutral'], 
 '{"favorite_colors": ["#f3f4f6", "#9ca3af", "#374151"], "avoid_colors": ["#dc2626", "#f59e0b"], "preferred_temperature": "cool", "brightness_preference": "medium"}',
 '{"min": 150, "max": 600, "currency": "USD"}');

-- Enable Row Level Security (RLS)
ALTER TABLE public.artwork ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.artwork_embedding ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.room_upload ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.session ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.user_profile ENABLE ROW LEVEL SECURITY;

-- Create policies for public access to artwork (read-only)
CREATE POLICY "Public artwork is viewable by everyone" ON public.artwork
    FOR SELECT USING (true);

CREATE POLICY "Public artwork_embedding is viewable by everyone" ON public.artwork_embedding
    FOR SELECT USING (true);

-- Create policies for user-specific data
CREATE POLICY "Users can view their own room uploads" ON public.room_upload
    FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own room uploads" ON public.room_upload
    FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can view their own sessions" ON public.session
    FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own sessions" ON public.session
    FOR INSERT WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can view their own profile" ON public.user_profile
    FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can update their own profile" ON public.user_profile
    FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own profile" ON public.user_profile
    FOR INSERT WITH CHECK (auth.uid() = user_id);
